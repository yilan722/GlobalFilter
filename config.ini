# config.ini
[STRATEGY]
# Pine Script中的参数
bb_length = 365
bb_mult = 2.0
ema_fast_length = 30
ema_slow_length = 90
trend_timeframe = 4h # 趋势过滤周期 (m for minutes, h for hours, d for day)

[MARKETS]
# 指向你的股票列表文件
us_stocks_path = stock_lists/us_stocks.txt
hk_stocks_path = stock_lists/hk_stocks.txt
cn_stocks_path = stock_lists/cn_stocks.txt```

#### **4. 准备股票列表**

在 `stock_lists/` 文件夹下，创建对应的 `.txt` 文件，每行放一个股票代码。

*   **`us_stocks.txt`**: `AAPL`, `GOOGL`, `MSFT` ...
*   **`hk_stocks.txt`**: `0700.HK`, `9988.HK` ... (港股代码在yfinance中需要`.HK`后缀)
*   **`cn_stocks.txt`**: `600519.SH`, `000001.SZ` ... (A股代码在Tushare中需要`.SH`或`.SZ`后缀)

---

### **第二阶段：编写核心代码模块**

现在我们来填充每个 `.py` 文件的内容。

#### **1. 数据获取器 (`data_fetcher.py`)**

这个模块负责从不同来源获取数据，并处理多时间周期（MTF）的问题。

```python
# data_fetcher.py
import yfinance as yf
import tushare as ts
import pandas as pd
import os

# 初始化Tushare
pro = ts.pro_api(os.getenv('TUSHARE_TOKEN'))

def get_yfinance_data(ticker, period="1y", interval="1d"):
    """使用yfinance获取美股/港股数据"""
    stock = yf.Ticker(ticker)
    df = stock.history(period=period, interval=interval)
    # yfinance列名为大写，统一为小写
    df.columns = [col.lower() for col in df.columns]
    return df

def get_tushare_data(ticker, start_date, end_date):
    """使用Tushare获取A股数据"""
    # Tushare的日期格式是YYYYMMDD
    df = pro.daily(ts_code=ticker, start_date=start_date, end_date=end_date)
    # Tushare返回的数据是倒序的，需要反转
    df = df.sort_values(by='trade_date', ascending=True)
    # 重命名列以匹配yfinance
    df = df.rename(columns={'trade_date': 'date', 'vol': 'volume'})
    df['date'] = pd.to_datetime(df['date'])
    df.set_index('date', inplace=True)
    return df
